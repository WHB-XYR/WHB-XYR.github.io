<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>利用tinymce编写网页文章并插入到MySQL数据库</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#00796b">
  <meta name="msapplication-TileColor" content="#4E8071"/>
  
  
  <link rel="alternative" href="/atom.xml" title="许源锐的小站" type="application/atom+xml">
  <link rel="icon" href="/img/favicon.ico">
  <link rel="stylesheet" href="/css/style.css" type="text/css"> 
</head>


<body>

  <div id="container" class="container">
    <div class="left-col">
    <div class="intrude-less">
  <header id="header" class="inner">
    <a href="/" class="profilepic">
      <img lazy-src="http://img.25pp.com/uploadfile/soft/images/2015/0731/20150731062222244.jpg" class="block-select js-avatar">
	</a>
	<p class="header-subtitle">兴趣永远是我们的动力</p>
    <nav class="header-menu">
      <ul>
        <li><a href="/">主页</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li><li><a href="/contact">联系</a></li>
      </ul>
    </nav>
  </header>				
</div>
<div class="bottom-logo" style="bottom: 5px;background: url(/img/me.png)transparent center no-repeat;background-size: 100%;margin: 0 30px;width: 75%;height: 120px;position: absolute;opacity: 0.4;"></div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  <div class="intrude-less">
    <header id="header" class="inner">
      <a href="/" class="profilepic">
        <img lazy-src="http://img.25pp.com/uploadfile/soft/images/2015/0731/20150731062222244.jpg" class="block-select js-avatar">
	  </a>
	  <p class="header-subtitle">兴趣永远是我们的动力</p>
	  <nav class="header-menu">
	    <ul>
        <li><a href="/">主页</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li><li><a href="/contact">联系</a></li><div class="clearfix"></div>
		</ul>
	  </nav>
	</header>				
  </div>
</nav>

      <div class="body-wrap">
<article id="post-tinymce-MySQL" class="article article-type-post" itemscope itemprop="blogPost">

   
    
    <div class="article-meta">
      
<div class="article-date">
<span class="datetime-published-tag"> 2016-10-04 </span>
</div>


    </div>
    
    
  
  <div class="article-inner block-select">
  
    
    
      <header class="article-header">
        
           
  
    <h1 class="article-title" itemprop="name">
      利用tinymce编写网页文章并插入到MySQL数据库
    </h1>
  

        
      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud block-select">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tinymce/">tinymce</a></li></ul>
	</div>


        
             <div class="clearfix"></div>
        
      </div>
      
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="tinymce是一个轻量级的基于浏览器的所见即所得编辑器，由JavaScript写成。以下我将为大家介绍如何使用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库。（将文章数据库表设计为只有两个字段，一个是int型的自增长id字段，另一个是text类型的article字段）"><a href="#tinymce是一个轻量级的基于浏览器的所见即所得编辑器，由JavaScript写成。以下我将为大家介绍如何使用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库。（将文章数据库表设计为只有两个字段，一个是int型的自增长id字段，另一个是text类型的article字段）" class="headerlink" title="tinymce是一个轻量级的基于浏览器的所见即所得编辑器，由JavaScript写成。以下我将为大家介绍如何使用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库。（将文章数据库表设计为只有两个字段，一个是int型的自增长id字段，另一个是text类型的article字段）"></a><em>tinymce</em>是一个轻量级的基于浏览器的所见即所得编辑器，由JavaScript写成。以下我将为大家介绍如何使用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库。（将文章数据库表设计为只有两个字段，一个是int型的自增长id字段，另一个是text类型的article字段）</h4><h5 id="第一步：在你的网站根目录（或者其他网站目录也行）下新建一个editor-html文件，编辑代码如下："><a href="#第一步：在你的网站根目录（或者其他网站目录也行）下新建一个editor-html文件，编辑代码如下：" class="headerlink" title="　　第一步：在你的网站根目录（或者其他网站目录也行）下新建一个editor.html文件，编辑代码如下："></a>　　第一步：在你的网站根目录（或者其他网站目录也行）下新建一个editor.html文件，编辑代码如下：</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>tinymce编辑文章<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://cdn.tinymce.com/4/tinymce.min.js"</span>&gt;</span><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="xml"></span></span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./event.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./htmlcode.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"editor"</span> <span class="attr">name</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"handin"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p> 　　这个文件将tinymce文章编辑器插件成功应用到我们的页面当中,并添加了一个用于提交文章到数据库的“提交”按钮。</p>
<p> 　　其中引入的event.js文件代码如下，应将其置于同一目录下。它是一个为DOM添加事件处理的兼容脚本。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">/**</div><div class="line"> * 为DOM添加事件处理的兼容脚本</div><div class="line"> * /</div><div class="line">var EventUtil = &#123;</div><div class="line">    // 添加句柄</div><div class="line">    addHandler: function (element, type, handler) &#123;</div><div class="line">        if (element.addEventListener) &#123;</div><div class="line">            element.addEventListener(type, handler, false);</div><div class="line">        &#125;</div><div class="line">        else if (element.attachEvent) &#123;</div><div class="line">            element.attachEvent(&apos;on&apos;+type, handler);</div><div class="line">        &#125;</div><div class="line">        else &#123;</div><div class="line">            element[&apos;on&apos;+type] = handler;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> 　　其中引入的htmlcode.js文件代码如下，同样将其置于editor.html同一目录下。它是一个实现html转码的脚本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">/**</div><div class="line"> * 用浏览器内部转换器实现</div><div class="line"> * javascript处理HTML的Encode(转码)和Decode(解码)</div><div class="line"> */</div><div class="line">var HtmlUtil = &#123;</div><div class="line">    // 用浏览器内部转换器实现html转码</div><div class="line">    // 首先动态创建一个容器标签元素，如DIV，</div><div class="line">    // 然后将要转换的字符串设置为这个元素的innerText(ie支持)</div><div class="line">    // 或者textContent(火狐，google支持)，最后返回这个元素的innerHTML，</div><div class="line">    // 即得到经过HTML编码转换的字符串了。</div><div class="line">    htmlEncode: function (html) &#123;  </div><div class="line">        var div = document.createElement(&apos;div&apos;);  </div><div class="line">        div.appendChild(document.createTextNode(html));  </div><div class="line">        return div.innerHTML;</div><div class="line">    &#125;,</div><div class="line">    // 用浏览器内部转换器实现html解码</div><div class="line">    // 首先动态创建一个容器标签元素，如DIV，</div><div class="line">    // 然后将要转换的字符串设置为这个元素的innerHTML(ie，火狐，google都支持)，</div><div class="line">    // 最后返回这个元素的innerText(ie支持)或者textContent(火狐，google支持)，</div><div class="line">    // 即得到经过HTML解码的字符串了。</div><div class="line">    htmlDecode: function (text) &#123;  </div><div class="line">        var div = document.createElement(&apos;div&apos;);  </div><div class="line">        div.innerHTML = text;  </div><div class="line">        return div.innerText || div.textContent;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="第二步：将以下代码插入到editor-html文件的底部，其实就是一些用script标签包起来的JavaScript代码。"><a href="#第二步：将以下代码插入到editor-html文件的底部，其实就是一些用script标签包起来的JavaScript代码。" class="headerlink" title="　　第二步：将以下代码插入到editor.html文件的底部，其实就是一些用script标签包起来的JavaScript代码。"></a>　　第二步：将以下代码插入到editor.html文件的底部，其实就是一些用script标签包起来的JavaScript代码。</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">    EventUtil.addHandler(document.getElementById('handin'), 'click', function () &#123;</div><div class="line">        // 创建一个XMLHttpRequest对象</div><div class="line">        var request = new XMLHttpRequest();</div><div class="line">        // 对articleToDB.php文件发出POST请求</div><div class="line">	    request.open('POST', './articleToDB.php');</div><div class="line"></div><div class="line">        // ajax传过去的参数都会被处理为字符串，因此不需要再将参数转换为字符串</div><div class="line">        // 先进行“去\n”操作，再进行html编码，使用的是浏览器内部转换器</div><div class="line">        var article = HtmlUtil.htmlEncode((tinyMCE.activeEditor.getContent()).replace(/[\n]/ig, ''));</div><div class="line">        // tinyMCE.activeEditor.getContent()方法会在我们写的文章里面的每一个\前再加一个\</div><div class="line">        // 当我们在文章里只写了一个\时，</div><div class="line">	    // tinyMCE.activeEditor.getContent()方法给我们多加了一个\</div><div class="line">	    // 此时就有了两个\，但是正则表达式不会匹配第一个作为转义字符作用的反斜杠'\'，</div><div class="line">	    // 在用正则表达式匹配字符串时，转义符相当于不存在</div><div class="line">	    // 因此在这里用正则匹配时就只需要4个转义符</div><div class="line">	    // 用replace()方法将其替换为4个\</div><div class="line">	    // 即符合mysql数据库3个转义符转义一个字符的规则</div><div class="line">        article = article.replace(/\\/g, '\\\\');</div><div class="line">        // 将获取的html代码中的"替换为\\\"</div><div class="line">        // 这样ajax才能正确读取参数并将其完整插入数据库</div><div class="line">        article = article.replace(/["]/g, '\\\"');</div><div class="line"></div><div class="line">        // 对处理完的字符串进行最终的编码，去除取值符等敏感字符对ajax传值的影响</div><div class="line">	    article = encodeURIComponent(article);</div><div class="line">        // 拼接请求主体</div><div class="line">	    var data = 'article=' + article;</div><div class="line">        // POST请求方式必须设置的请求头格式</div><div class="line">	    request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');</div><div class="line">	    request.send(data);</div><div class="line">        request.onreadystatechange = function () &#123;</div><div class="line">	    	if (request.readyState === 4) &#123;</div><div class="line">	    		if (request.status === 200) &#123;</div><div class="line">	    			// 弹出相关文字提示</div><div class="line">                    alert(request.responseText);</div><div class="line">	    		&#125;</div><div class="line">	    		else &#123;</div><div class="line">	    			// 当请求不到数据时就会导致错误，用以下方法显示</div><div class="line">	    			alert('发生错误：' + request.status);</div><div class="line">	    		&#125;</div><div class="line">	    	&#125;</div><div class="line">	    &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">```html</div><div class="line"></div><div class="line">##### 　　第三步：编写articleToDB.php文件实现文章插入MySQL数据库，并将其置于editor.html同一目录下。</div><div class="line">```php</div><div class="line"></div><div class="line">    &lt;?php</div><div class="line">    header('Content-Type: application/json; charset=utf-8');</div><div class="line">    // 若取不到值，那么进行相应的信息反馈并结束</div><div class="line">    if (!isset($_POST['article']) || empty($_POST['article'])) &#123;</div><div class="line">        echo '您还没有编辑文章';</div><div class="line">        exit;</div><div class="line">    &#125;</div><div class="line">    // 面向对象的建立数据库连接的方法</div><div class="line">    // 应该填写服务器数据库的主机名，用户名以及相对应的密码</div><div class="line">    // 比如$db = new mysqli('localhost','root','123456789');</div><div class="line">    $db = new mysqli('主机名','用户名','密码');</div><div class="line"></div><div class="line">    if (mysqli_connect_errno()) &#123;</div><div class="line">        echo '连接数据库失败，请稍后重试！';</div><div class="line">        exit;</div><div class="line">    &#125;</div><div class="line">    // 判断数据库是否存在</div><div class="line">    $select = $db-&gt;select_db('article');</div><div class="line">    if (!$select) &#123;</div><div class="line">        // 创建数据库失败后的处理提示</div><div class="line">        $createDB_query = 'create database article';</div><div class="line">        $createDB = $db-&gt;query($createDB_query);</div><div class="line">        if (!$createDB) &#123;</div><div class="line">            echo '创建数据库失败';</div><div class="line">            exit;</div><div class="line">        &#125;</div><div class="line">        //使用数据库失败后的处理提示</div><div class="line">        $useDB_query = 'use article';</div><div class="line">        $useDB = $db-&gt;query($useDB_query);</div><div class="line">        if (!$useDB) &#123;</div><div class="line">            echo '使用数据库失败';</div><div class="line">            exit;</div><div class="line">        &#125;</div><div class="line">        else &#123;</div><div class="line">	        echo '成功';</div><div class="line">            exit;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    // 设置数据库编码</div><div class="line">    $db-&gt;query('set names utf8');</div><div class="line">    // 此处在接收到经过编码的article后，通过=操作符，实现了解码</div><div class="line">    $article = $_POST['article'];</div><div class="line">    $insert_query = 'insert into text2 values(NULL, "'.$article.'")';</div><div class="line">    $insert_result = $db-&gt;query($insert_query);</div><div class="line">    // 对返回结果进行判断</div><div class="line">    if ($insert_result) &#123;</div><div class="line">        echo '成功！管理员文章发布成功！';</div><div class="line">    &#125;</div><div class="line">    else &#123;</div><div class="line">        echo '失败！管理员文章发布失败！';</div><div class="line">    &#125;</div><div class="line">    // 关闭数据库连接</div><div class="line">    $db-&gt;close();</div></pre></td></tr></table></figure>
<h4 id="以上三步便是利用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库的全过程，需要注意的点有以下几个："><a href="#以上三步便是利用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库的全过程，需要注意的点有以下几个：" class="headerlink" title="　　以上三步便是利用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库的全过程，需要注意的点有以下几个："></a>　　以上三步便是利用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库的全过程，需要注意的点有以下几个：</h4><p> 　　1. html代码必须经过转码后才能插入数据库; </p>
<p> 　　2. 字符串’\\’长度为1而不是2;</p>
<p> 　　3. 正则表达式匹配字符串时并不匹配起转义字符作用的反斜杠’\’;</p>
<p> 　　4. 在插入MySQL数据库时，3个转义字符转义一个字符</p>

      
      
      
        <div class="post-copyright">
<p><a href="http://www.whbxyr.cn/2016/10/04/tinymce-MySQL/">本文</a>为原创，转载请遵守本站<a href="/copyright/">版权声明</a></p>
<p class="updated-time" >更新于: </span>2016年10月4日 20:10</p>
</div>

      
    </div>
    
  </div>
  
    
<nav id="article-nav" class="block-select">
  
  
    <a href="/2016/09/06/JS-RegExp/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">JavaScript之正则表达式</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>


  
</article>


<div class="duoshuo block-select">
<div class="commentwrap comments-hidden">

    <div class="comments-main">

    	<div class="ds-thread" data-thread-key="tinymce-MySQL" data-title="利用tinymce编写网页文章并插入到MySQL数据库" data-url="http://www.whbxyr.cn/2016/10/04/tinymce-MySQL/"></div><script type="text/javascript">var duoshuoQuery = {short_name:"whbxyr"};(function() { var ds = document.createElement('script'); ds.type = 'text/javascript';ds.async = true; ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js'; ds.charset = 'UTF-8';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds); })();</script>
    </div>
</div>





</div>
      <footer id="footer" class="block-select">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">&copy; 2015-2016
        <a href="/contact/" class ="aboutme-foot-tag"> 许源锐</a>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script>
	var ThemeXConfig = {fancybox: false,mathjax: false,animate: true,isHome: false,isPost: true,isArchive: false,isTag: false,isCategory: false,open_in_new: false, CDN_PATH: '' }
</script>


    <script src="/js/jquery-1.9.1.min.js"></script>
    <script src="/js/base.js"></script>
    <script src="/js/jquery.lazyload.min.js"></script>





  </div>
</body>
</html>
