<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>许源锐的小站</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#00796b">
  <meta name="msapplication-TileColor" content="#4E8071"/>
  
  
  <link rel="alternative" href="/atom.xml" title="许源锐的小站" type="application/atom+xml">
  <link rel="icon" href="/img/favicon.ico">
  <link rel="stylesheet" href="/css/style.css" type="text/css"> 
</head>


<body>

  <div id="container" class="container">
    <div class="left-col">
    <div class="intrude-less">
  <header id="header" class="inner">
    <a href="/" class="profilepic">
      <img lazy-src="http://img.25pp.com/uploadfile/soft/images/2015/0731/20150731062222244.jpg" class="block-select js-avatar">
	</a>
	<p class="header-subtitle">兴趣永远是我们的动力</p>
    <nav class="header-menu">
      <ul>
        <li><a href="/">主页</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li><li><a href="/contact">联系</a></li>
      </ul>
    </nav>
  </header>				
</div>
<div class="bottom-logo" style="bottom: 5px;background: url(/img/me.png)transparent center no-repeat;background-size: 100%;margin: 0 30px;width: 75%;height: 120px;position: absolute;opacity: 0.4;"></div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  <div class="intrude-less">
    <header id="header" class="inner">
      <a href="/" class="profilepic">
        <img lazy-src="http://img.25pp.com/uploadfile/soft/images/2015/0731/20150731062222244.jpg" class="block-select js-avatar">
	  </a>
	  <p class="header-subtitle">兴趣永远是我们的动力</p>
	  <nav class="header-menu">
	    <ul>
        <li><a href="/">主页</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li><li><a href="/contact">联系</a></li><div class="clearfix"></div>
		</ul>
	  </nav>
	</header>				
  </div>
</nav>

      <div class="body-wrap">
  
    
<article id="post-tinymce-MySQL" class="article article-type-post" itemscope itemprop="blogPost">

   
    
  
  <div class="article-inner block-select">
  
    
    
      <header class="article-header">
        
           
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/04/tinymce-MySQL/">利用tinymce编写网页文章并插入到MySQL数据库</a>
    </h1>
  

        
      </header>
      
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="tinymce是一个轻量级的基于浏览器的所见即所得编辑器，由JavaScript写成。以下我将为大家介绍如何使用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库。（将文章数据库表设计为只有两个字段，一个是int型的自增长id字段，另一个是text类型的article字段）"><a href="#tinymce是一个轻量级的基于浏览器的所见即所得编辑器，由JavaScript写成。以下我将为大家介绍如何使用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库。（将文章数据库表设计为只有两个字段，一个是int型的自增长id字段，另一个是text类型的article字段）" class="headerlink" title="tinymce是一个轻量级的基于浏览器的所见即所得编辑器，由JavaScript写成。以下我将为大家介绍如何使用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库。（将文章数据库表设计为只有两个字段，一个是int型的自增长id字段，另一个是text类型的article字段）"></a><em>tinymce</em>是一个轻量级的基于浏览器的所见即所得编辑器，由JavaScript写成。以下我将为大家介绍如何使用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库。（将文章数据库表设计为只有两个字段，一个是int型的自增长id字段，另一个是text类型的article字段）</h4><h5 id="第一步：在你的网站根目录（或者其他网站目录也行）下新建一个editor-html文件，编辑代码如下："><a href="#第一步：在你的网站根目录（或者其他网站目录也行）下新建一个editor-html文件，编辑代码如下：" class="headerlink" title="　　第一步：在你的网站根目录（或者其他网站目录也行）下新建一个editor.html文件，编辑代码如下："></a>　　第一步：在你的网站根目录（或者其他网站目录也行）下新建一个editor.html文件，编辑代码如下：</h5><pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;tinymce编辑文章&lt;/title&gt;
    &lt;script src=&quot;http://cdn.tinymce.com/4/tinymce.min.js&quot;&gt;&lt;script&gt;
    &lt;script src=&quot;./event.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;./htmlcode.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;textarea id=&quot;editor&quot; name=&quot;content&quot;&gt;&lt;/textarea&gt;
    &lt;input id=&quot;handin&quot; type=&quot;button&quot; value=&quot;提交&quot;&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p> 　　这个文件将tinymce文章编辑器插件成功应用到我们的页面当中,并添加了一个用于提交文章到数据库的“提交”按钮。</p>
<p> 　　其中引入的event.js文件代码如下，应将其置于同一目录下。它是一个为DOM添加事件处理的兼容脚本。</p>
<pre><code>/**
 * 为DOM添加事件处理的兼容脚本
 * /
var EventUtil = {
    // 添加句柄
    addHandler: function (element, type, handler) {
        if (element.addEventListener) {
            element.addEventListener(type, handler, false);
        }
        else if (element.attachEvent) {
            element.attachEvent(&apos;on&apos;+type, handler);
        }
        else {
            element[&apos;on&apos;+type] = handler;
        }
    }
}   
</code></pre><p> 　　其中引入的htmlcode.js文件代码如下，同样将其置于editor.html同一目录下。它是一个实现html转码的脚本。</p>
<pre><code>/**
 * 用浏览器内部转换器实现
 * javascript处理HTML的Encode(转码)和Decode(解码)
 */
var HtmlUtil = {
    // 用浏览器内部转换器实现html转码
    // 首先动态创建一个容器标签元素，如DIV，
    // 然后将要转换的字符串设置为这个元素的innerText(ie支持)
    // 或者textContent(火狐，google支持)，最后返回这个元素的innerHTML，
    // 即得到经过HTML编码转换的字符串了。
    htmlEncode: function (html) {  
        var div = document.createElement(&apos;div&apos;);  
        div.appendChild(document.createTextNode(html));  
        return div.innerHTML;
    },
    // 用浏览器内部转换器实现html解码
    // 首先动态创建一个容器标签元素，如DIV，
    // 然后将要转换的字符串设置为这个元素的innerHTML(ie，火狐，google都支持)，
    // 最后返回这个元素的innerText(ie支持)或者textContent(火狐，google支持)，
    // 即得到经过HTML解码的字符串了。
    htmlDecode: function (text) {  
        var div = document.createElement(&apos;div&apos;);  
        div.innerHTML = text;  
        return div.innerText || div.textContent;
    }
}
</code></pre><h5 id="第二步：将以下代码插入到editor-html文件的底部，其实就是一些用script标签包起来的JavaScript代码。"><a href="#第二步：将以下代码插入到editor-html文件的底部，其实就是一些用script标签包起来的JavaScript代码。" class="headerlink" title="　　第二步：将以下代码插入到editor.html文件的底部，其实就是一些用script标签包起来的JavaScript代码。"></a>　　第二步：将以下代码插入到editor.html文件的底部，其实就是一些用script标签包起来的JavaScript代码。</h5><pre><code>&lt;script&gt;
EventUtil.addHandler(document.getElementById(&apos;handin&apos;), &apos;click&apos;, function () {
    // 创建一个XMLHttpRequest对象
    var request = new XMLHttpRequest();
    // 对articleToDB.php文件发出POST请求
    request.open(&apos;POST&apos;, &apos;./articleToDB.php&apos;);

    // ajax传过去的参数都会被处理为字符串，因此不需要再将参数转换为字符串
    // 先进行“去\n”操作，再进行html编码，使用的是浏览器内部转换器
    var article = HtmlUtil.htmlEncode((tinyMCE.activeEditor.getContent()).replace(/[\n]/ig, &apos;&apos;));
    // tinyMCE.activeEditor.getContent()方法会在我们写的文章里面的每一个\前再加一个\
    // 当我们在文章里只写了一个\时，
    // tinyMCE.activeEditor.getContent()方法给我们多加了一个\
    // 此时就有了两个\，但是正则表达式不会匹配第一个作为转义字符作用的反斜杠&apos;\&apos;，
    // 在用正则表达式匹配字符串时，转义符相当于不存在
    // 因此在这里用正则匹配时就只需要4个转义符
    // 用replace()方法将其替换为4个\
    // 即符合mysql数据库3个转义符转义一个字符的规则
    article = article.replace(/\\/g, &apos;\\\\&apos;);
    // 将获取的html代码中的&quot;替换为\\\&quot;
    // 这样ajax才能正确读取参数并将其完整插入数据库
    article = article.replace(/[&quot;]/g, &apos;\\\&quot;&apos;);

    // 对处理完的字符串进行最终的编码，去除取值符等敏感字符对ajax传值的影响
    article = encodeURIComponent(article);
    // 拼接请求主体
    var data = &apos;article=&apos; + article;
    // POST请求方式必须设置的请求头格式
    request.setRequestHeader(&apos;Content-type&apos;, &apos;application/x-www-form-urlencoded&apos;);
    request.send(data);
    request.onreadystatechange = function () {
        if (request.readyState === 4) {
            if (request.status === 200) {
                // 弹出相关文字提示
                alert(request.responseText);
            }
            else {
                // 当请求不到数据时就会导致错误，用以下方法显示
                alert(&apos;发生错误：&apos; + request.status);
            }
        }
    }
});
&lt;/script&gt;
</code></pre><h5 id="第三步：编写articleToDB-php文件实现文章插入MySQL数据库，并将其置于editor-html同一目录下。"><a href="#第三步：编写articleToDB-php文件实现文章插入MySQL数据库，并将其置于editor-html同一目录下。" class="headerlink" title="　　第三步：编写articleToDB.php文件实现文章插入MySQL数据库，并将其置于editor.html同一目录下。"></a>　　第三步：编写articleToDB.php文件实现文章插入MySQL数据库，并将其置于editor.html同一目录下。</h5><pre><code>&lt;?php
header(&apos;Content-Type: application/json; charset=utf-8&apos;);
// 若取不到值，那么进行相应的信息反馈并结束
if (!isset($_POST[&apos;article&apos;]) || empty($_POST[&apos;article&apos;])) {
    echo &apos;您还没有编辑文章&apos;;
    exit;
}
// 面向对象的建立数据库连接的方法
// 应该填写服务器数据库的主机名，用户名以及相对应的密码
// 比如$db = new mysqli(&apos;localhost&apos;,&apos;root&apos;,&apos;123456789&apos;);
$db = new mysqli(&apos;主机名&apos;,&apos;用户名&apos;,&apos;密码&apos;);

if (mysqli_connect_errno()) {
    echo &apos;连接数据库失败，请稍后重试！&apos;;
    exit;
}
// 判断数据库是否存在
$select = $db-&gt;select_db(&apos;article&apos;);
if (!$select) {
    // 创建数据库失败后的处理提示
    $createDB_query = &apos;create database article&apos;;
    $createDB = $db-&gt;query($createDB_query);
    if (!$createDB) {
        echo &apos;创建数据库失败&apos;;
        exit;
    }
    //使用数据库失败后的处理提示
    $useDB_query = &apos;use article&apos;;
    $useDB = $db-&gt;query($useDB_query);
    if (!$useDB) {
        echo &apos;使用数据库失败&apos;;
        exit;
    }
    else {
        echo &apos;成功&apos;;
        exit;
    }
}
// 设置数据库编码
$db-&gt;query(&apos;set names utf8&apos;);
// 此处在接收到经过编码的article后，通过=操作符，实现了解码
$article = $_POST[&apos;article&apos;];
$insert_query = &apos;insert into text2 values(NULL, &quot;&apos;.$article.&apos;&quot;)&apos;;
$insert_result = $db-&gt;query($insert_query);
// 对返回结果进行判断
if ($insert_result) {
    echo &apos;成功！管理员文章发布成功！&apos;;
}
else {
    echo &apos;失败！管理员文章发布失败！&apos;;
}
// 关闭数据库连接
$db-&gt;close();
</code></pre><h4 id="以上三步便是利用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库的全过程，需要注意的点有以下几个："><a href="#以上三步便是利用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库的全过程，需要注意的点有以下几个：" class="headerlink" title="　　以上三步便是利用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库的全过程，需要注意的点有以下几个："></a>　　以上三步便是利用JavaScript的Ajax、配合使用php将tinymce中编写的文章经过转码后顺利存储进MySQL数据库的全过程，需要注意的点有以下几个：</h4><p> 　　1. html代码必须经过转码后才能插入数据库; </p>
<p> 　　2. 字符串’\\’长度为1而不是2;</p>
<p> 　　3. 正则表达式匹配字符串时并不匹配起转义字符作用的反斜杠’\’;</p>
<p> 　　4. 在插入MySQL数据库时，3个转义字符转义一个字符</p>

      
      
      
    </div>
    
  </div>
  
</article>





  
    
<article id="post-JS-RegExp" class="article article-type-post" itemscope itemprop="blogPost">

   
    
  
  <div class="article-inner block-select">
  
    
    
      <header class="article-header">
        
           
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/06/JS-RegExp/">JavaScript之正则表达式</a>
    </h1>
  

        
      </header>
      
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言：何为正则表达式"><a href="#前言：何为正则表达式" class="headerlink" title="前言：何为正则表达式"></a>前言：何为正则表达式</h2>
      
      
      
    </div>
    
  </div>
  
</article>





  
  

</div>
      <footer id="footer" class="block-select">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">&copy; 2015-2016
        <a href="/contact/" class ="aboutme-foot-tag"> 许源锐</a>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script>
	var ThemeXConfig = {fancybox: false,mathjax: false,animate: true,isHome: true,isPost: false,isArchive: false,isTag: false,isCategory: false,open_in_new: false, CDN_PATH: '' }
</script>


    <script src="/js/jquery-1.9.1.min.js"></script>
    <script src="/js/base.js"></script>
    <script src="/js/jquery.lazyload.min.js"></script>





  </div>
</body>
</html>
